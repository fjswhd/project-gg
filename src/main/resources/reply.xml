<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="replyns">

	<!-- 댓글 리스트 -->
	<select id="rpList" parameterType="reply" resultType ="reply">
		select * from (select a.*, rowNum rn, nickname from(select * from reply where b_no=#{b_no} and del='n'order by re_no desc)a 
		,member m where m.m_id = a.m_id) where rn between #{startRow} and #{endRow} 
	</select>
	
	<!-- 댓글 갯수 구하기 -->
	<select id="getTotal" parameterType="reply" resultType ="integer">
		select count(*) from reply where b_no=#{b_no} and del='n'
	</select>
	
	<!-- 새댓글 번호 구하기 -->
	<select id="maxNo" resultType="integer">
		select nvl(max(re_no),0) + 1 from reply
	</select>
	   
	<!-- 댓글 입력 -->
	<insert id="insert" parameterType="reply">
		insert into reply values( #{re_no}, 1, 'b',  #{content}, 0, 0, sysdate, #{secret} , 'n' )
<!-- 원래 써야할 sql		insert into reply values( #{re_no}, #{b_no}, #{m_id}, #{content}, 0, 0, sysdate, #{secret} , 'n' ) -->
	</insert>
	
	<!-- 댓글 수정 폼  -->
	<select id="select" parameterType="integer" resultType ="reply"> 
		select a.*,nickname from (select * from reply where re_no=#{re_no})a, member m where m.m_id = a.m_id
	</select>
	
	<!-- 댓글 수정 -->
	<update id="update" parameterType="reply">
		update reply set content=#{content} where re_no=#{re_no}
	</update>
	
	<!-- 댓글 삭제 -->
	<update id="delete" parameterType="integer">
		update reply set del ='y' where re_no=#{re_no}
	</update>
	
	<!-- 댓글 50개 입력 -->
	<insert id="autoInsert" parameterType="reply">
		insert into reply values( #{re_no}, 1, 'e',  #{content}, 0, 0, sysdate, 'n' , 'n' )
	</insert>
</mapper>